## Length of Longest V-Shaped Diagonal Segment

注意题目里只能转一次弯且只能向顺时针方向转。

```python
class Solution:
    def lenOfVDiagonal(self, grid: List[List[int]]) -> int:
        n = len(grid)
        m = len(grid[0])
        directions = [(-1, 1), (-1, -1), (1, -1), (1, 1)]
        if n == 1:
            return 1 if 1 in grid[0] else 0
        if m == 1:
            for row in grid:
                if row[0] == 1:
                    return 1
            return 0
        @cache
        def helper(x, y, qd, turn=0):
            if turn:
                nx, ny = x+directions[qd][0], y+directions[qd][1]
                if nx >= n or nx < 0 or ny >= m or ny < 0:
                    return 1
                if grid[x][y] == 2 and grid[nx][ny] == 0:
                    return 1+helper(nx, ny, qd, turn)
                elif grid[x][y] == 0 and grid[nx][ny] == 2:
                    return 1+helper(nx, ny, qd, turn)
                else:
                    return 1
            else:
                res = 1
                for nd in [qd, qd-1]:
                    nx, ny = x+directions[nd][0], y+directions[nd][1]
                    if nx >= n or nx < 0 or ny >= m or ny < 0:
                        continue
                    elif grid[x][y] == 2 and grid[nx][ny] == 0:
                        res = max(res, 1+helper(nx, ny, nd, 1 if nd != qd else 0))
                    elif grid[x][y] == 0 and grid[nx][ny] == 2:
                        res = max(res, 1+helper(nx, ny, nd, 1 if nd != qd else 0))
                return res

        max_len = 0
        for i, row in enumerate(grid):
            for j, cell in enumerate(row):
                if cell == 1:
                    max_len = max(max_len, 1)
                    for idx_d, d in enumerate(directions):
                        nx, ny = i+d[0], j+d[1]
                        if nx >= n or nx < 0 or ny >= m or ny < 0:
                            continue
                        else:
                            if grid[nx][ny] == 2:
                                max_len = max(max_len, 1+helper(nx, ny, idx_d, 0))
        return max_len
```