## Count Submatrices With All Ones

首先，只需要一个`vector<int>`就能达成dp计算`1`的高度：`h[j] = mat[i][j] ? h[j]+1 : 0;`。

其次，使用**单调栈 Monotonic Stack**的话，在更新每层新加总数的时候，可以以$O(n)$复杂度代替$O(n^2)$。

```cpp
class Solution {
public:
    int numSubmat(vector<vector<int>>& mat) {
        int m = mat.size(), n = mat[0].size(), res = 0;
        vector<int> h(n, 0);
        for (int i=0; i<m; i++) {
            for (int j=0; j<n; j++) { h[j] = mat[i][j] > 0 ? h[j]+1 : 0; }
            vector<pair<int, int>> ms;
            int cur_res = 0;
            for (int c: h) {
                int cnt = 1;
                while ((!ms.empty()) && (ms.back().first>=c)) {
                    cur_res -= ms.back().first * ms.back().second;
                    cnt += ms.back().second;
                    ms.pop_back();
                }
                cur_res += c * cnt;
                ms.push_back(pair<int, int>(c, cnt));
                res += cur_res;
            }
        }
        return res;
    }
};
```